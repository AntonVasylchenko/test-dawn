document.addEventListener("DOMContentLoaded",function(){let e=document.querySelector(".lookbook__modal");var t=e?.querySelector(".lookbook__modal-content");function o(t){e&&(t=t||e.classList.contains("lookbook__modal--active"),e.classList.toggle("lookbook__modal--active",!t),document.body.classList.toggle("overflow-hidden",!t),t?document.removeEventListener("keydown",r):document.addEventListener("keydown",r))}function r(t){"Escape"===t.key&&o(!0)}document.querySelectorAll(".lookbook__triger button, .lookbook__modal, .modal-content__close").forEach(t=>t?.addEventListener("click",()=>o())),t?.addEventListener("click",t=>t.stopPropagation());class i extends HTMLElement{constructor(){super(),this.form=this.querySelector("form"),this.selector=this.querySelector("select"),this.sectionId="lookbook-item-api",this.variantContainer=this.parentElement,this.errorContainer=this.querySelector(".lookbook-actions__form-error"),this.cart=document.querySelector("cart-notification")||document.querySelector("cart-drawer"),this.cartMethods=this.initializeCartMethods(),this.sectionCache={}}connectedCallback(){this.form.addEventListener("submit",this.onSubmitHandler.bind(this)),this.selector?.addEventListener("change",this.onChangeVariant.bind(this))}async onChangeVariant(){var t=this.generateProductUrl(this.sectionId,this.selector),t=this.sectionCache[this.selector.value]||await this.fetchAndParseMarkup(t);this.sectionCache[this.selector.value]||(this.sectionCache[this.selector.value]=t),t&&this.variantContainer?this.variantContainer.replaceWith(t):console.error("No valid source found in fetched markup.")}async fetchAndParseMarkup(t){try{var e=await fetch(t);if(!e.ok)throw new Error("Network response was not ok: "+e.statusText);var r=await e.text(),o=(new DOMParser).parseFromString(r,"text/html").querySelector(".shopify-section");if(o)return o.querySelector(".shopify-section > div");throw new Error("No .shopify-section found in the fetched markup.")}catch(t){console.error("Error fetching and parsing markup:",t)}}generateProductUrl(t,e){var{value:e,dataset:{url:r}}=e;return r+`?variant=${e}&section_id=`+t}initializeCartMethods(){var t,e;return this.cart?({renderContents:t,getSectionsToRender:e}=this.cart,{addProperty:e?e.bind(this.cart):null,updateCart:t?t.bind(this.cart):null,updateCartStatus:()=>{this.cart.classList.contains("is-empty")&&this.cart.classList.remove("is-empty")}}):{}}onSubmitHandler(t){t.preventDefault();var e,t=fetchConfig("javascript"),r=(t.headers["X-Requested-With"]="XMLHttpRequest",delete t.headers["Content-Type"],new FormData(this.form));this.cartMethods.addProperty&&(e=this.cartMethods.addProperty().map(t=>t.id),r.append("sections",e)),t.body=r,fetch(window.Shopify.routes.root+"cart/add.js",t).then(t=>t.json()).then(t=>{t.status?(this.error=!0,this.handleErrorNotification(t.errors||t.description)):this.cart?(this.error=!1,!this.error&&this.cartMethods.updateCartStatus&&this.cartMethods.updateCartStatus(),!this.error&&this.cartMethods.updateCart&&this.cartMethods.updateCart(t),this.error||o(!0)):window.location=window.routes.cart_url}).catch(t=>{console.error(t)})}handleErrorNotification(t){this.errorContainer.toggleAttribute("hidden",!t),this.errorContainer&&t&&(this.errorContainer.textContent=t)}}customElements.define("lookbook-product",i)});